#!/bin/bash

set -e

echo "Installing packages..."

{{ if eq .chezmoi.os "darwin" -}}
# macOS - Homebrew
if ! command -v brew &> /dev/null; then
    echo "Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

brew bundle --no-lock --file=/dev/stdin <<EOF
# Modern CLI replacements
brew "eza"
brew "bat"
brew "fd"
brew "ripgrep"
brew "sd"
brew "bottom"
brew "btop"
brew "dust"
brew "duf"
brew "procs"
brew "zoxide"
brew "curlie"
brew "dog"

# Fuzzy finder & prompt
brew "fzf"
brew "starship"

# Dev tools
brew "fnm"
brew "bun"
brew "tmux"
brew "neovim"
brew "git"
brew "lazygit"
brew "lazydocker"
brew "delta"
brew "gh"
brew "just"
brew "direnv"
brew "tokei"

# Utilities
brew "curl"
brew "wget"
brew "rsync"
brew "mosh"
brew "jq"
brew "yq"
brew "tree"
brew "htop"
brew "tldr"
brew "chezmoi"
EOF

{{ else if eq .chezmoi.os "linux" -}}
# Arch Linux - pacman
{{ if lookPath "pacman" -}}
sudo pacman -S --needed --noconfirm \
    eza \
    bat \
    fd \
    ripgrep \
    sd \
    bottom \
    btop \
    dust \
    duf \
    procs \
    zoxide \
    curlie \
    dog \
    fzf \
    starship \
    fnm \
    bun \
    tmux \
    neovim \
    git \
    lazygit \
    lazydocker \
    git-delta \
    github-cli \
    just \
    direnv \
    tokei \
    curl \
    wget \
    rsync \
    mosh \
    jq \
    yq \
    tree \
    htop \
    tldr \
    chezmoi \
    base-devel

{{ end -}}
{{ end -}}

echo "Packages installed!"

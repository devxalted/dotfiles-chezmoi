{{ if eq .chezmoi.os "linux" -}}
#!/bin/bash
# Configure keyd for tap=Escape / hold=Control on Caps Lock
# keyd config hash: v1

set -e

if command -v keyd &> /dev/null; then
    echo "Configuring keyd..."
    sudo mkdir -p /etc/keyd
    sudo tee /etc/keyd/default.conf > /dev/null <<'EOF'
[ids]
*

[main]
capslock = overload(control, esc)
EOF
    sudo systemctl enable keyd
    sudo systemctl restart keyd
    echo "keyd configured: Caps Lock = tap Escape, hold Control"
fi
{{ end -}}
